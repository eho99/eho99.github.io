<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/a3c8ea0a23c20410.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-e9c1cf3bb53853c0.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-4468e7344580c19c.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-cc0406e334767cbc.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-95958f547fe00c1d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/992-1b4c952970b7bd1a.js" async=""></script><script src="/_next/static/chunks/326-90ef47a638866464.js" async=""></script><script src="/_next/static/chunks/app/projects/page-d805231f03118742.js" async=""></script><script src="/_next/static/chunks/app/projects/%5Bslug%5D/page-89c0829e5f4b5c66.js" async=""></script><title>eho99 — Portfolio</title><meta name="description" content="Technical project portfolio"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"><div class="container flex h-16 items-center justify-between"><a class="flex items-center space-x-2" href="/"><span class="font-bold text-xl bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent">eho99</span></a><nav class="flex items-center space-x-2"><a class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2" href="/projects/">Projects</a><a class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2" href="/about/">About</a></nav></div></header><main class="container py-8"><div class="container"><h1 class="text-3xl font-bold">Project 1: Images of the Russian Empire -- Colorizing the Prokudin-Gorskii photo collection</h1><p class="mt-2 text-lg text-gray-600">Colorizing images from the Prokudin-Gorskii photo collection</p><hr class="my-6"/><div class="my-8"><h1 class="text-2xl font-bold mb-4">Primer</h1><p class="mb-4">The images in the Prokudin-Gorskii collection represent an early attempt to start color photography by taking the &quot;same&quot; image of a subject through three colored filters: red, green, and blue.<br/> <br/>To combine them into a single color image, the images of each color channel need to be aligned properly. This project uses single-scale and multi-scale alignment algorithms by computing the normalized cross-correlation (NCC) at various displacements between the images to align the red and green channel images to the blue channel.</p></div><div class="my-8"><h1 class="text-2xl font-bold mb-4">Single-Scale Alignment</h1><h2 class="text-xl font-bold mb-2">Methodology</h2><p class="mb-4">For smaller images (jpgs), a single pass approach on the base scale images is sufficient to achieve a good alignment. By trying all combinations of <code>[-dx, -dy]</code> displacements in the range <code>[-15, 15]</code>, the optimal alignment can be found by maximizing the normalized cross-correlation (NCC) between the channels. Using that displacement, we can use <code>np.roll()</code> to do an x-y shift and align the channels.</p><h2 class="text-xl font-bold mb-2">Results</h2><p class="mb-4">Results from single-scale alignment on smaller images:</p><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4"><div class="flex flex-col items-center"><img alt="Cathedral colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/small_color_no_grad/cathedral_colored.jpg"/><p class="text-sm mt-2 text-center">Cathedral (see &quot;Bells and Whistles&quot; for better alignment)</p></div><div class="flex flex-col items-center"><img alt="Monastery colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/small_color_no_grad/monastery_colored.jpg"/><p class="text-sm mt-2 text-center">Monastery</p></div><div class="flex flex-col items-center"><img alt="Tobolsk colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/small_color_no_grad/tobolsk_colored.jpg"/><p class="text-sm mt-2 text-center">Tobolsk</p></div></div></div><div class="my-8"><h1 class="text-2xl font-bold mb-4">Multi-scale Alignment</h1><h2 class="text-xl font-bold mb-2">Methodology</h2><p class="mb-4">For the larger <code>.tif</code> images, a scaled pyramid approach was used to speed up and reduce the search space.<br/> <br/>When profiling the speed of <code>np.roll()</code> and <code>ncc()</code> operations, we are bottlenecked by number of displacements we need to check for each image. With the increasing scale, it&#x27;s reasonable to check under 9 displacements at the highest resolution images. Thus, starting from the down-scaled image, we can use a large displacement search <code>[-20, 20]</code> and successively refine the displacement search space as we move up the pyramid to the original resolution image. At each level, we need to multiply the displacement found by a scale factor to handle the translation into the upsized image.<br/> <br/>Emperically, a 6 level pyramid sped up the alignment of <code>emir.tif</code> from ~209 seconds to ~24 seconds, a speed up of around 88.5%.</p><h2 class="text-xl font-bold mb-2">Results</h2><p class="mb-4">Results from multi-scale alignment on larger images:</p><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4"><div class="flex flex-col items-center"><img alt="Church colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/church_colored.jpg"/><p class="text-sm mt-2 text-center">Church</p></div><div class="flex flex-col items-center"><img alt="Emir colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/emir_colored.jpg"/><p class="text-sm mt-2 text-center">Emir (see &quot;Bells and Whistles&quot; for better alignment)</p></div><div class="flex flex-col items-center"><img alt="Harvesters colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/harvesters_colored.jpg"/><p class="text-sm mt-2 text-center">Harvesters</p></div><div class="flex flex-col items-center"><img alt="Icon colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/icon_colored.jpg"/><p class="text-sm mt-2 text-center">Icon</p></div><div class="flex flex-col items-center"><img alt="Italil colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/italil_colored.jpg"/><p class="text-sm mt-2 text-center">Italil</p></div><div class="flex flex-col items-center"><img alt="Lastochikino colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/lastochikino_colored.jpg"/><p class="text-sm mt-2 text-center">Lastochikino</p></div><div class="flex flex-col items-center"><img alt="Lugano colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/lugano_colored.jpg"/><p class="text-sm mt-2 text-center">Lugano</p></div><div class="flex flex-col items-center"><img alt="Melons colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/melons_colored.jpg"/><p class="text-sm mt-2 text-center">Melons</p></div><div class="flex flex-col items-center"><img alt="Self Portrait colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/self_portrait_colored.jpg"/><p class="text-sm mt-2 text-center">Self Portrait</p></div><div class="flex flex-col items-center"><img alt="Siren colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/siren_colored.jpg"/><p class="text-sm mt-2 text-center">Siren</p></div><div class="flex flex-col items-center"><img alt="Three Generations colored result" loading="lazy" width="400" height="400" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/large_colored/three_generations_colored.jpg"/><p class="text-sm mt-2 text-center">Three Generations</p></div></div><h1 class="text-2xl font-bold mb-4">Problems and Challenges</h1><h2 class="text-xl font-bold mb-2">Initial Alignment</h2><p class="mb-4">When initially aligning the images (<code>cathedral.jpg</code>), I had difficulty lining up the image because I wasn&#x27;t properly aligning the images due to artifacting from the borders. At first I attempted to crop the borders before aligning the content through a simple percentage calculation, but further refinement by only considering the the central portion of the image led to much better alignment. The refinement is further improved with the gradient approach (see Bells and Whistles)</p><h2 class="text-xl font-bold mb-2">Challenges with Multi-Scale Alignment</h2><p class="mb-4">I had a lot of challenges getting the search space / window of the multi-scale alignment dialed, ultimately setting the search window at each level to be <code>start_window // level</code> for all levels after 1.<br/> <br/>Following this, I also had initially implemented the scaling offset multiplier as a static 2x multiplier. This static multiplier caused errors depending on the divisibility of the shapes of the images, creating rounding errors between levels. Thus, I updated this to be a dynamic multiplier based on the shape of the previous image and the shape of the current image to be more accurate.</p><h2 class="text-xl font-bold mb-2">Emir of Bukhara</h2><p class="mb-4">The photo of the Emir of Bukhara is misaligned with the default multi-scale method due to the brightness values not being the same. Thus, we can see that the red channel is clearly mis-aligned, something that can be rectified through the gradient approach.</p><h1 class="text-2xl font-bold mb-4">Bells and Whistles</h1><h2 class="text-xl font-bold mb-2">Gradients</h2><p class="mb-4">To improve alignment on select images (emir.tif and cathedral.jpg) as well as overall performance, we can align using the gradients of the images instead of the pixel brightness values. The gradient computes the derivative across the image which will allow effects differently scaled color brightness values to be nullified since the NCC score will be taken on the &quot;direction&quot; or change between brightness pixel values. We can see the direct impact of this on the <code>cathedral.jpg</code> and <code>emir.tif</code> source images.</p><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4"><div class="flex flex-col items-center"><img alt="Cathedral colored result with gradients" loading="lazy" width="600" height="600" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/grad/cathedral_colored_grad.jpg"/><p class="text-sm mt-2 text-center">Cathedral (with gradients)</p></div><div class="flex flex-col items-center"><img alt="Emir colored result with gradients" loading="lazy" width="600" height="600" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/grad/emir_colored_grad.jpg"/><p class="text-sm mt-2 text-center">Emir (with gradients)</p></div></div><h1 class="text-2xl font-bold mb-4">Putting It All Together: Custom Images</h1><p class="mb-4">Looking at the impacts of the improvements between alignment methods, we can clearly see the progression on these custom images.</p><h2 class="text-xl font-bold mb-2">Single-Scale (No Gradients)</h2><p class="mb-4">Basic single-scale alignment using normalized cross-correlation on pixel values:</p><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-4"><div class="flex flex-col items-center"><img alt="Camel - Single-scale no gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_no_grad/camel_colored.jpg"/><p class="text-sm mt-2 text-center">Camel</p></div><div class="flex flex-col items-center"><img alt="Golodnaya - Single-scale no gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_no_grad/golodnaya_colored.jpg"/><p class="text-sm mt-2 text-center">Golodnaya</p></div><div class="flex flex-col items-center"><img alt="Mosaic - Single-scale no gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_no_grad/mosaic_colored.jpg"/><p class="text-sm mt-2 text-center">Mosaic</p></div><div class="flex flex-col items-center"><img alt="Sheep - Single-scale no gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_no_grad/sheep_colored.jpg"/><p class="text-sm mt-2 text-center">Sheep</p></div></div><h2 class="text-xl font-bold mb-2">Gradient-Based Alignment</h2><p class="mb-4">Improved alignment using gradients to handle brightness variations between channels:</p><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-4"><div class="flex flex-col items-center"><img alt="Camel - Gradient-based alignment" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_grad/camel_colored.jpg"/><p class="text-sm mt-2 text-center">Camel</p></div><div class="flex flex-col items-center"><img alt="Golodnaya - Gradient-based alignment" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_grad/golodnaya_colored.jpg"/><p class="text-sm mt-2 text-center">Golodnaya</p></div><div class="flex flex-col items-center"><img alt="Mosaic - Gradient-based alignment" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_grad/mosaic_colored.jpg"/><p class="text-sm mt-2 text-center">Mosaic</p></div><div class="flex flex-col items-center"><img alt="Sheep - Gradient-based alignment" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_grad/sheep_colored.jpg"/><p class="text-sm mt-2 text-center">Sheep</p></div></div><h2 class="text-xl font-bold mb-2">Multi-Scale Pyramid with Gradients</h2><p class="mb-4">Best results combining multi-scale pyramid (2 level) approach with gradient-based alignment:</p><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-4"><div class="flex flex-col items-center"><img alt="Camel - Multi-scale pyramid with gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_pyramid_2/camel_colored.jpg"/><p class="text-sm mt-2 text-center">Camel</p></div><div class="flex flex-col items-center"><img alt="Golodnaya - Multi-scale pyramid with gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_pyramid_2/golodnaya_colored.jpg"/><p class="text-sm mt-2 text-center">Golodnaya</p></div><div class="flex flex-col items-center"><img alt="Mosaic - Multi-scale pyramid with gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_pyramid_2/mosaic_colored.jpg"/><p class="text-sm mt-2 text-center">Mosaic</p></div><div class="flex flex-col items-center"><img alt="Sheep - Multi-scale pyramid with gradients" loading="lazy" width="300" height="300" decoding="async" data-nimg="1" class="rounded-lg" style="color:transparent" src="/proj1/custom_image_pyramid_2/sheep_colored.jpg"/><p class="text-sm mt-2 text-center">Sheep</p></div></div></div></div></main><script src="/_next/static/chunks/webpack-e9c1cf3bb53853c0.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/a3c8ea0a23c20410.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:I[3728,[],\"\"]\n5:I[9928,[],\"\"]\n6:I[8326,[\"992\",\"static/chunks/992-1b4c952970b7bd1a.js\",\"326\",\"static/chunks/326-90ef47a638866464.js\",\"895\",\"static/chunks/app/projects/page-d805231f03118742.js\"],\"\"]\n7:I[6954,[],\"\"]\n8:I[7264,[],\"\"]\na:I[413,[\"992\",\"static/chunks/992-1b4c952970b7bd1a.js\",\"101\",\"static/chunks/app/projects/%5Bslug%5D/page-89c0829e5f4b5c66.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a3c8ea0a23c20410.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L3\",null,{\"buildId\":\"pj0fpKpdyWSSXw5hBjmPt\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/projects/proj-1/\",\"initialTree\":[\"\",{\"children\":[\"projects\",{\"children\":[[\"slug\",\"proj-1\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"proj-1\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L4\"],\"globalErrorComponent\":\"$5\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\",\"children\":[\"$\",\"div\",null,{\"className\":\"container flex h-16 items-center justify-between\",\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/\",\"className\":\"flex items-center space-x-2\",\"children\":[\"$\",\"span\",null,{\"className\":\"font-bold text-xl bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent\",\"children\":\"eho99\"}]}],[\"$\",\"nav\",null,{\"className\":\"flex items-center space-x-2\",\"children\":[[\"$\",\"$L6\",null,{\"href\":\"/projects\",\"children\":\"Projects\",\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2\"}],[\"$\",\"$L6\",null,{\"href\":\"/about\",\"children\":\"About\",\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2\"}]]}]]}]}],[\"$\",\"main\",null,{\"className\":\"container py-8\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\",[\"slug\",\"proj-1\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L9\",[\"$\",\"div\",null,{\"className\":\"container\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold\",\"children\":\"Project 1: Images of the Russian Empire -- Colorizing the Prokudin-Gorskii photo collection\"}],[\"$\",\"p\",null,{\"className\":\"mt-2 text-lg text-gray-600\",\"children\":\"Colorizing images from the Prokudin-Gorskii photo collection\"}],[\"$\",\"hr\",null,{\"className\":\"my-6\"}],[[\"$\",\"div\",null,{\"className\":\"my-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-4\",\"children\":\"Primer\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":[\"The images in the Prokudin-Gorskii collection represent an early attempt to start color photography by taking the \\\"same\\\" image of a subject through three colored filters: red, green, and blue.\",[\"$\",\"br\",null,{}],\" \",[\"$\",\"br\",null,{}],\"To combine them into a single color image, the images of each color channel need to be aligned properly. This project uses single-scale and multi-scale alignment algorithms by computing the normalized cross-correlation (NCC) at various displacements between the images to align the red and green channel images to the blue channel.\"]}]]}],[\"$\",\"div\",null,{\"className\":\"my-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-4\",\"children\":\"Single-Scale Alignment\"}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Methodology\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":[\"For smaller images (jpgs), a single pass approach on the base scale images is sufficient to achieve a good alignment. By trying all combinations of \",[\"$\",\"code\",null,{\"children\":\"[-dx, -dy]\"}],\" displacements in the range \",[\"$\",\"code\",null,{\"children\":\"[-15, 15]\"}],\", the optimal alignment can be found by maximizing the normalized cross-correlation (NCC) between the channels. Using that displacement, we can use \",[\"$\",\"code\",null,{\"children\":\"np.roll()\"}],\" to do an x-y shift and align the channels.\"]}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Results\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"Results from single-scale alignment on smaller images:\"}],[\"$\",\"div\",null,{\"className\":\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/small_color_no_grad/cathedral_colored.jpg\",\"alt\":\"Cathedral colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Cathedral (see \\\"Bells and Whistles\\\" for better alignment)\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/small_color_no_grad/monastery_colored.jpg\",\"alt\":\"Monastery colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Monastery\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/small_color_no_grad/tobolsk_colored.jpg\",\"alt\":\"Tobolsk colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Tobolsk\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"my-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-4\",\"children\":\"Multi-scale Alignment\"}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Methodology\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":[\"For the larger \",[\"$\",\"code\",null,{\"children\":\".tif\"}],\" images, a scaled pyramid approach was used to speed up and reduce the search space.\",[\"$\",\"br\",null,{}],\" \",[\"$\",\"br\",null,{}],\"When profiling the speed of \",[\"$\",\"code\",null,{\"children\":\"np.roll()\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"ncc()\"}],\" operations, we are bottlenecked by number of displacements we need to check for each image. With the increasing scale, it's reasonable to check under 9 displacements at the highest resolution images. Thus, starting from the down-scaled image, we can use a large displacement search \",[\"$\",\"code\",null,{\"children\":\"[-20, 20]\"}],\" and successively refine the displacement search space as we move up the pyramid to the original resolution image. At each level, we need to multiply the displacement found by a scale factor to handle the translation into the upsized image.\",[\"$\",\"br\",null,{}],\" \",[\"$\",\"br\",null,{}],\"Emperically, a 6 level pyramid sped up the alignment of \",[\"$\",\"code\",null,{\"children\":\"emir.tif\"}],\" from ~209 seconds to ~24 seconds, a speed up of around 88.5%.\"]}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Results\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"Results from multi-scale alignment on larger images:\"}],[\"$\",\"div\",null,{\"className\":\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/church_colored.jpg\",\"alt\":\"Church colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Church\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/emir_colored.jpg\",\"alt\":\"Emir colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Emir (see \\\"Bells and Whistles\\\" for better alignment)\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/harvesters_colored.jpg\",\"alt\":\"Harvesters colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Harvesters\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/icon_colored.jpg\",\"alt\":\"Icon colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Icon\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/italil_colored.jpg\",\"alt\":\"Italil colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Italil\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/lastochikino_colored.jpg\",\"alt\":\"Lastochikino colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Lastochikino\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/lugano_colored.jpg\",\"alt\":\"Lugano colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Lugano\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/melons_colored.jpg\",\"alt\":\"Melons colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Melons\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/self_portrait_colored.jpg\",\"alt\":\"Self Portrait colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Self Portrait\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/siren_colored.jpg\",\"alt\":\"Siren colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Siren\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/large_colored/three_generations_colored.jpg\",\"alt\":\"Three Generations colored result\",\"width\":400,\"height\":400,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Three Generations\"}]]}]]}],[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-4\",\"children\":\"Problems and Challenges\"}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Initial Alignment\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":[\"When initially aligning the images (\",[\"$\",\"code\",null,{\"children\":\"cathedral.jpg\"}],\"), I had difficulty lining up the image because I wasn't properly aligning the images due to artifacting from the borders. At first I attempted to crop the borders before aligning the content through a simple percentage calculation, but further refinement by only considering the the central portion of the image led to much better alignment. The refinement is further improved with the gradient approach (see Bells and Whistles)\"]}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Challenges with Multi-Scale Alignment\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":[\"I had a lot of challenges getting the search space / window of the multi-scale alignment dialed, ultimately setting the search window at each level to be \",[\"$\",\"code\",null,{\"children\":\"start_window // level\"}],\" for all levels after 1.\",[\"$\",\"br\",null,{}],\" \",[\"$\",\"br\",null,{}],\"Following this, I also had initially implemented the scaling offset multiplier as a static 2x multiplier. This static multiplier caused errors depending on the divisibility of the shapes of the images, creating rounding errors between levels. Thus, I updated this to be a dynamic multiplier based on the shape of the previous image and the shape of the current image to be more accurate.\"]}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Emir of Bukhara\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"The photo of the Emir of Bukhara is misaligned with the default multi-scale method due to the brightness values not being the same. Thus, we can see that the red channel is clearly mis-aligned, something that can be rectified through the gradient approach.\"}],[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-4\",\"children\":\"Bells and Whistles\"}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Gradients\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":[\"To improve alignment on select images (emir.tif and cathedral.jpg) as well as overall performance, we can align using the gradients of the images instead of the pixel brightness values. The gradient computes the derivative across the image which will allow effects differently scaled color brightness values to be nullified since the NCC score will be taken on the \\\"direction\\\" or change between brightness pixel values. We can see the direct impact of this on the \",[\"$\",\"code\",null,{\"children\":\"cathedral.jpg\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"emir.tif\"}],\" source images.\"]}],[\"$\",\"div\",null,{\"className\":\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/grad/cathedral_colored_grad.jpg\",\"alt\":\"Cathedral colored result with gradients\",\"width\":600,\"height\":600,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Cathedral (with gradients)\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/grad/emir_colored_grad.jpg\",\"alt\":\"Emir colored result with gradients\",\"width\":600,\"height\":600,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Emir (with gradients)\"}]]}]]}],[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold mb-4\",\"children\":\"Putting It All Together: Custom Images\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"Looking at the impacts of the improvements between alignment methods, we can clearly see the progression on these custom images.\"}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Single-Scale (No Gradients)\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"Basic single-scale alignment using normalized cross-correlation on pixel values:\"}],[\"$\",\"div\",null,{\"className\":\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_no_grad/camel_colored.jpg\",\"alt\":\"Camel - Single-scale no gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Camel\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_no_grad/golodnaya_colored.jpg\",\"alt\":\"Golodnaya - Single-scale no gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Golodnaya\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_no_grad/mosaic_colored.jpg\",\"alt\":\"Mosaic - Single-scale no gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Mosaic\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_no_grad/sheep_colored.jpg\",\"alt\":\"Sheep - Single-scale no gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Sheep\"}]]}]]}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Gradient-Based Alignment\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"Improved alignment using gradients to handle brightness variations between channels:\"}],[\"$\",\"div\",null,{\"className\":\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_grad/camel_colored.jpg\",\"alt\":\"Camel - Gradient-based alignment\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Camel\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_grad/golodnaya_colored.jpg\",\"alt\":\"Golodnaya - Gradient-based alignment\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Golodnaya\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_grad/mosaic_colored.jpg\",\"alt\":\"Mosaic - Gradient-based alignment\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Mosaic\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_grad/sheep_colored.jpg\",\"alt\":\"Sheep - Gradient-based alignment\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Sheep\"}]]}]]}],[\"$\",\"h2\",null,{\"className\":\"text-xl font-bold mb-2\",\"children\":\"Multi-Scale Pyramid with Gradients\"}],[\"$\",\"p\",null,{\"className\":\"mb-4\",\"children\":\"Best results combining multi-scale pyramid (2 level) approach with gradient-based alignment:\"}],[\"$\",\"div\",null,{\"className\":\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_pyramid_2/camel_colored.jpg\",\"alt\":\"Camel - Multi-scale pyramid with gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Camel\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_pyramid_2/golodnaya_colored.jpg\",\"alt\":\"Golodnaya - Multi-scale pyramid with gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Golodnaya\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_pyramid_2/mosaic_colored.jpg\",\"alt\":\"Mosaic - Multi-scale pyramid with gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Mosaic\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center\",\"children\":[[\"$\",\"$La\",null,{\"src\":\"/proj1/custom_image_pyramid_2/sheep_colored.jpg\",\"alt\":\"Sheep - Multi-scale pyramid with gradients\",\"width\":300,\"height\":300,\"className\":\"rounded-lg\"}],[\"$\",\"p\",null,{\"className\":\"text-sm mt-2 text-center\",\"children\":\"Sheep\"}]]}]]}]]}]]]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"proj-1\\\"}\"},\"styles\":[]}],\"segment\":[\"slug\",\"proj-1\",\"d\"]},\"styles\":[]}],\"segment\":\"projects\"},\"styles\":[]}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"4:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"eho99 — Portfolio\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Technical project portfolio\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n9:null\n"])</script></body></html>